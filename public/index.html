<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Sulama Asistanƒ± ‚Äì Beta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Manifest ve ikon (zorunlu deƒüil, klas√∂rde ikon yoksa console'da uyarƒ± √ßƒ±kar, √ßalƒ±≈ümayƒ± bozmaz) -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/png" href="/icons/icon-192.png" />

  <style>
    :root {
      --bg: #0f172a;
      --bg-elevated: #020617;
      --bg-chat: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.1);
      --accent-border: #16a34a;
      --accent-strong: #4ade80;
      --danger: #f97373;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --text-softer: #6b7280;
      --border-subtle: #1f2937;
      --border-strong: #374151;
      --shadow-soft: 0 20px 50px rgba(15, 23, 42, 0.9);
      --shadow-chip: 0 10px 25px rgba(15, 23, 42, 0.7);
      --radius-xl: 20px;
      --radius-full: 999px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at 0% 0%, #052e16, #020617 40%, #000),
        radial-gradient(circle at 100% 100%, #0f172a, #020617 50%, #000);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    body {
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    .app-shell {
      max-width: 1200px;
      width: 100%;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .top-row {
      display: flex;
      gap: 16px;
      align-items: stretch;
      flex-direction: column;
    }

    @media (min-width: 1024px) {
      .top-row {
        flex-direction: row;
      }
    }

    .card {
      background: radial-gradient(circle at 0 0, #0f172a 0, #020617 35%, #000)
          padding-box,
        linear-gradient(135deg, rgba(34, 197, 94, 0.5), rgba(15, 23, 42, 0.9))
          border-box;
      border: 1px solid transparent;
      border-radius: 24px;
      padding: 20px 20px 18px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -1px;
      background: radial-gradient(
        circle at 0 0,
        rgba(34, 197, 94, 0.20),
        transparent 45%
      );
      opacity: 0.65;
      pointer-events: none;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    .auth-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-left: 12px;
    }

    .auth-btn {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: all 0.15s ease-out;
      white-space: nowrap;
      cursor: pointer;
    }

    .auth-btn.primary {
      border-color: rgba(34, 197, 94, 0.8);
      color: var(--accent-strong);
      box-shadow: 0 6px 16px rgba(22, 163, 74, 0.5);
    }

    .auth-btn:hover {
      border-color: rgba(34, 197, 94, 0.8);
      color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.5),
        0 8px 18px rgba(22, 163, 74, 0.35);
      transform: translateY(-0.5px);
    }

    .auth-btn:active {
      transform: translateY(0.5px);
      box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
    }

    @media (max-width: 768px) {
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .auth-buttons {
        align-self: stretch;
        justify-content: flex-start;
      }
    }

    .badge-beta {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 4px 10px 4px 4px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(34, 197, 94, 0.4);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9), var(--shadow-chip);
    }

    .badge-beta-pill {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #bbf7d0, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.6),
        0 8px 16px rgba(21, 128, 61, 0.7);
      position: relative;
      overflow: hidden;
    }

    .badge-beta-pill span {
      font-size: 11px;
      font-weight: 800;
      color: #052e16;
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
    }

    .badge-beta-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .badge-beta-text strong {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent-strong);
    }

    .badge-beta-text span {
      font-size: 10px;
      color: var(--text-soft);
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-line {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-title {
      font-size: 20px;
      font-weight: 650;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .app-title span.logo-dot {
      display: inline-flex;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #bbf7d0, #22c55e);
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.6),
        0 6px 14px rgba(22, 163, 74, 0.7);
      position: relative;
      overflow: hidden;
    }

    .app-title span.logo-dot::after {
      content: "";
      position: absolute;
      inset: 32%;
      border-radius: inherit;
      border: 1px solid rgba(22, 163, 74, 0.4);
      box-shadow: inset 0 0 0 1px rgba(34, 197, 94, 0.5);
      opacity: 0.9;
    }

    .app-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      max-width: 480px;
    }

    .app-subtitle strong {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .chip {
      font-size: 11px;
      border-radius: 999px;
      padding: 4px 10px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(31, 41, 55, 0.9);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: var(--shadow-chip);
    }

    .chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .chip span.dot.red {
      background: #f97373;
    }

    .chip span.dot.amber {
      background: #facc15;
    }

    .chip span.dot.blue {
      background: #38bdf8;
    }

    .chip strong {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .chip-muted {
      opacity: 0.9;
    }

    .imits-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-softer);
    }

    .limits-row span.highlight {
      color: var(--accent-strong);
    }

    .limits-row strong {
      color: var(--text-soft);
      font-weight: 500;
    }

    .chat-layout {
      display: flex;
      gap: 16px;
      margin-top: 8px;
      position: relative;
      z-index: 1;
      align-items: stretch;
      flex-direction: column;
    }

    @media (min-width: 1024px) {
      .chat-layout {
        flex-direction: row;
      }
    }

    .chat-panel {
      flex: 2;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .messages-container {
      background: radial-gradient(
            circle at 0% 0%,
            rgba(34, 197, 94, 0.08),
            transparent 60%
          )
          padding-box,
        linear-gradient(
            to bottom,
            rgba(15, 23, 42, 0.95),
            rgba(15, 23, 42, 0.98),
            #020617
          )
          border-box;
      border-radius: 18px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 10px 12px 12px;
      min-height: 300px;
      max-height: 520px;
      overflow-y: auto;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .messages-container::-webkit-scrollbar {
      width: 8px;
    }

    .messages-container::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 999px;
    }

    .messages-container::-webkit-scrollbar-thumb {
      background: rgba(31, 41, 55, 0.95);
      border-radius: 999px;
    }

    .message {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 8px;
      position: relative;
    }

    .message:last-child {
      margin-bottom: 0;
    }

    .message-icon {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .message-icon.user {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: var(--text);
    }

    .message-icon.assistant {
      background: radial-gradient(circle at 30% 20%, #bbf7d0, #22c55e);
      border: 1px solid rgba(22, 163, 74, 0.9);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.95),
        0 8px 16px rgba(22, 163, 74, 0.8);
      color: #022c22;
    }

    .message-bubble {
      border-radius: 14px;
      padding: 8px 10px;
      font-size: 13px;
      line-height: 1.6;
      max-width: 100%;
      position: relative;
      border: 1px solid transparent;
    }

    .message.user .message-bubble {
      background: radial-gradient(
            circle at 80% 0%,
            rgba(34, 197, 94, 0.08),
            transparent 50%
          )
          padding-box,
        linear-gradient(
            135deg,
            rgba(31, 41, 55, 0.98),
            rgba(15, 23, 42, 0.98)
          )
          border-box;
      border-color: rgba(55, 65, 81, 0.9);
    }

    .message.assistant .message-bubble {
      background: radial-gradient(
            circle at 0% 0%,
            rgba(34, 197, 94, 0.12),
            transparent 50%
          )
          padding-box,
        linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.99)
          )
          border-box;
      border-color: rgba(31, 41, 55, 0.9);
    }

    .message.assistant.system-warning .message-bubble {
      border-color: rgba(248, 113, 113, 0.9);
      background: linear-gradient(
        135deg,
        rgba(127, 29, 29, 0.9),
        rgba(15, 23, 42, 0.98)
      );
    }

    .message-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 3px;
      gap: 8px;
    }

    .message-meta {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .message-role {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-soft);
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .message.assistant .message-role {
      color: var(--accent-strong);
    }

    .message-timestamp {
      font-size: 10px;
      color: var(--text-softer);
    }

    .message.model-tag {
      font-size: 10px;
      color: var(--text-softer);
      margin-left: auto;
    }

    .message-content p + p {
      margin-top: 6px;
    }

    .message-content ul,
    .message-content ol {
      padding-left: 18px;
      margin: 4px 0;
    }

    .message-content li {
      margin: 2px 0;
    }

    .message-content code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.9);
      padding: 2px 4px;
      border-radius: 4px;
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .message-content pre {
      background: rgba(15, 23, 42, 0.95);
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      overflow-x: auto;
      font-size: 11px;
      margin: 4px 0;
    }

        /* Teklif tablolarƒ± ve genel toplam alanƒ± i√ßin */
    .message-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 13px;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 10px;
      overflow: hidden;
    }

    .message-content th,
    .message-content td {
      padding: 8px 10px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      text-align: left;
    }

    .message-content th {
      font-weight: 600;
      color: #e5e7eb;
      background: rgba(15, 23, 42, 1);
    }

    .message-content tr:last-child td {
      border-bottom: none;
    }

    .message-content .genel-toplam {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      font-weight: 600;
      font-size: 14px;
      color: #bbf7d0;
    }


    .thinking-indicator {
      display: none;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-softer);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(31, 41, 55, 0.9);
      width: fit-content;
      margin: 4px 0 0 40px;
      box-shadow: var(--shadow-chip);
    }

    .thinking-balls {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .thinking-balls span {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-strong);
      opacity: 0.8;
      animation: pulse 1.4s infinite ease-in-out both;
    }

    .thinking-balls span:nth-child(2) {
      animation-delay: -0.16s;
    }

    .thinking-balls span:nth-child(3) {
      animation-delay: -0.32s;
    }

    .thinking-text {
      white-space: nowrap;
    }

    @keyframes pulse {
      0%,
      80%,
      100% {
        transform: scale(0.6);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .input-panel {
      margin-top: 4px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 10px 10px 8px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.8);
    }

    .question-helpers {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
    }

    .helper-chip {
      font-size: 11px;
      line-height: 1.2;
      border-radius: 999px;
      padding: 4px 9px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(31, 41, 55, 0.95);
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s ease-out;
    }

    .helper-chip strong {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .helper-chip:hover {
      border-color: rgba(34, 197, 94, 0.6);
      color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.5),
        0 8px 20px rgba(22, 163, 74, 0.35);
      transform: translateY(-0.5px);
    }

    .helper-chip:active {
      transform: translateY(0.5px);
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.5),
        0 3px 10px rgba(22, 163, 74, 0.3);
    }

    .helper-chip span.bullet {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: var(--accent);
    }

    .input-row {
      display: flex;
      align-items: flex-end;
      gap: 8px;
    }

    .input-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .input-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-softer);
      padding: 0 2px;
    }

    .input-label-row strong {
      color: var(--text-soft);
      font-weight: 500;
    }

    .textarea-wrapper {
      position: relative;
    }

    #userInput {
      width: 100%;
      min-height: 48px;
      max-height: 120px;
      resize: vertical;
      padding: 8px 36px 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.98);
      color: var(--text);
      font-size: 13px;
      line-height: 1.5;
      font-family: inherit;
      outline: none;
      transition: border-color 0.15s ease-out, box-shadow 0.15s ease-out,
        background 0.15s ease-out;
    }

    #userInput::placeholder {
      color: var(--text-softer);
    }

    #userInput:focus {
      border-color: rgba(34, 197, 94, 0.7);
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.5),
        0 0 0 2px rgba(21, 128, 61, 0.4);
      background: rgba(15, 23, 42, 0.98);
    }

    .input-counter {
      font-size: 10px;
      color: var(--text-softer);
      text-align: right;
      padding: 0 4px;
    }

    .send-button {
      border-radius: 14px;
      padding: 8px 14px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      min-width: 48px;
      background: linear-gradient(
        135deg,
        #22c55e,
        #16a34a,
        #22c55e,
        #4ade80
      );
      background-size: 200% 200%;
      color: #052e16;
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 10px 25px rgba(22, 163, 74, 0.6);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out,
        background-position 0.3s ease-out, opacity 0.2s ease-out;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
    }

    .send-button span.icon {
      font-size: 15px;
      display: inline-flex;
      transform-origin: center;
      transition: transform 0.1s ease-out;
    }

    .send-button span.text {
      display: inline-block;
    }

    .send-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(22, 163, 74, 0.7);
      background-position: 100% 0;
    }

    .send-button:hover span.icon {
      transform: translateX(2px);
    }

    .send-button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(22, 163, 74, 0.5);
    }

    .send-button:disabled {
      opacity: 0.65;
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.9);
      background: linear-gradient(
        135deg,
        #15803d,
        #166534,
        #15803d
      );
      background-size: 100% 100%;
    }

    .send-key-hint {
      font-size: 10px;
      color: var(--text-softer);
      text-align: center;
      margin-top: 3px;
    }

    .right-panel {
      flex: 1.4;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 280px;
      max-width: 380px;
    }

    .right-panel-card {
      background: radial-gradient(
            circle at 100% 0%,
            rgba(34, 197, 94, 0.16),
            transparent 60%
          )
          padding-box,
        linear-gradient(
            135deg,
            rgba(15, 23, 42, 0.98),
            rgba(15, 23, 42, 0.99)
          )
          border-box;
      border-radius: 18px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      padding: 12px 12px 10px;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.95);
      position: relative;
      overflow: hidden;
    }

    .right-panel-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at 100% 0%,
        rgba(34, 197, 94, 0.16),
        transparent 60%
      );
      opacity: 0.7;
      pointer-events: none;
    }

    .right-panel-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      position: relative;
      z-index: 1;
    }

    .right-panel-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .right-panel-title span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.7);
    }

    .right-panel-subtitle {
      font-size: 11px;
      color: var(--text-softer);
      margin-bottom: 4px;
      position: relative;
      z-index: 1;
    }

    .example-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
      z-index: 1;
    }

    .example-item {
      border-radius: 12px;
      padding: 7px 8px;
      font-size: 12px;
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: rgba(15, 23, 42, 0.98);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .example-item strong {
      color: var(--accent-strong);
      font-weight: 500;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .example-item span {
      color: var(--text-soft);
      font-size: 12px;
    }

    .usage-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-softer);
      margin-top: 6px;
      position: relative;
      z-index: 1;
    }

    .usage-row strong {
      color: var(--text-soft);
    }

    .usage-bar {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      margin-left: 8px;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(31, 41, 55, 0.95);
      position: relative;
    }

    .usage-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #4ade80, #22c55e);
      width: 25%;
    }

    .alert-box {
      margin-top: 4px;
      border-radius: 12px;
      padding: 6px 8px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(55, 65, 81, 0.95);
      color: var(--text-soft);
      display: flex;
      gap: 6px;
      align-items: flex-start;
      position: relative;
      z-index: 1;
    }

    .alert-box strong {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .alert-box span.icon {
      font-size: 13px;
      margin-top: 1px;
    }

    .footer-note {
      margin-top: 2px;
      font-size: 10px;
      color: var(--text-softer);
      position: relative;
      z-index: 1;
    }

    .footer-note strong {
      color: var(--accent-strong);
      font-weight: 500;
    }

    .disclaimer {
      margin-top: 4px;
      font-size: 10px;
      color: var(--text-softer);
      padding-top: 6px;
      border-top: 1px dashed rgba(31, 41, 55, 0.9);
    }

    .disclaimer strong {
      color: var(--accent-strong);
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(31, 41, 55, 0.9);
      color: var(--text-softer);
    }

    @media (max-width: 768px) {
      .card {
        padding: 14px 12px 12px;
      }

      .messages-container {
        max-height: 380px;
      }

      .right-panel {
        max-width: none;
      }

      .message-icon {
        display: none;
      }

      .thinking-indicator {
        margin-left: 4px;
      }

      .app-title {
        font-size: 18px;
      }

      .app-subtitle {
        font-size: 11px;
      }

      .message-bubble {
        font-size: 12px;
      }

      #userInput {
        min-height: 48px;
      }
    }

    /* === PROFESYONEL TEKLƒ∞F TABLOSU === */
.malzeme-tablo {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
  background: rgba(15, 23, 42, 0.98);
  border-radius: 10px;
  overflow: hidden;
  font-size: 14px;
}

.malzeme-tablo th,
.malzeme-tablo td {
  border-bottom: 1px solid rgba(31, 41, 55, 0.8);
  padding: 10px;
  color: #e5e7eb;
  vertical-align: top;
}

.malzeme-tablo th {
  font-weight: 600;
  background: rgba(31, 41, 55, 1);
  text-align: left;
}

.malzeme-tablo tr:last-child td {
  border-bottom: none;
}

.genel-toplam {
  margin-top: 12px;
  padding: 10px 0;
  font-size: 15px;
  font-weight: 700;
  color: #bbf7d0;
  border-top: 1px solid rgba(31, 41, 55, 0.8);
}

  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card">
      <div class="card-header">
        <div class="title-group">
          <div class="title-line">
            <div class="app-title">
              <span class="logo-dot"></span>
              Sulama Asistanƒ±
            </div>
            <div class="badge-beta">
              <div class="badge-beta-pill">
                <span>Œ≤</span>
              </div>
              <div class="badge-beta-text">
                <strong>BETA S√úR√úM</strong>
                <span>Test a≈üamasƒ±nda, hata yapabilir</span>
              </div>
            </div>
          </div>
          <div class="app-subtitle">
            Villa ve peyzaj bah√ßeleri i√ßin <strong>otomatik sulama sistemi</strong> hesabƒ±, malzeme listesi ve teklif
            analizi yapabilen bir yapay zek√¢ asistanƒ±dƒ±r.
          </div>
          <div class="chip-row">
            <div class="chip">
              <span class="dot"></span>
              <span><strong>Villa / Peyzaj</strong> odaklƒ± sulama hesabƒ±</span>
            </div>
            <div class="chip chip-muted">
              <span class="dot blue"></span>
              <span>TS EN standartlarƒ±na yakƒ±n <strong>hidrolik hesap</strong></span>
            </div>
            <div class="chip chip-muted">
              <span class="dot amber"></span>
              <span><strong>√úr√ºn e≈üle≈ütirme</strong> + kabaca maliyet analizi</span>
            </div>
          </div>
        </div>

        <!-- Gƒ∞Rƒ∞≈û YAP / KAYIT OL BUTONLARI -->
        <div class="auth-buttons" id="authButtons">
          <!-- JS load sƒ±rasƒ±nda doldurulacak -->
        </div>
      </div>

      <div class="chat-layout">
        <div class="chat-panel">
          <div id="messages" class="messages-container"></div>

          <div id="thinkingIndicator" class="thinking-indicator">
            <div class="thinking-balls">
              <span></span><span></span><span></span>
            </div>
            <div class="thinking-text">Sulama Asistanƒ± d√º≈ü√ºn√ºyor...</div>
          </div>

          <form id="chatForm" class="input-panel">
            <div class="question-helpers">
              <button type="button" class="helper-chip" data-example="400 m¬≤ dikd√∂rtgen bah√ßem var. Depo + hidrofor kullanacaƒüƒ±m. √áim alan ve 8 adet aƒüa√ß var. Ankara i√ßin tam otomatik sulama sistemi hesabƒ± yapar mƒ±sƒ±n?">
                <span class="bullet"></span>
                <span><strong>√ñrnek</strong> villa bah√ßesi hesabƒ±</span>
              </button>
              <button type="button" class="helper-chip" data-example="200 m¬≤ L ≈üeklinde √ßim alanƒ±m var. ≈ûebeke suyu, basƒ±n√ß 3 bar. Sadece √ßim i√ßin otomatik sulama hesabƒ± ve malzeme listesi verir misin?">
                <span class="bullet"></span>
                <span>≈ûebeke suyu ile <strong>√ßim sulama</strong></span>
              </button>
              <button type="button" class="helper-chip" data-example="250 m¬≤ bah√ßemde hem √ßim hem de damla sulama olacak. Alanƒ± kƒ±saca tarif edeceƒüim, bana zone daƒüƒ±lƒ±mƒ±, boru √ßaplarƒ± ve vana sayƒ±sƒ±nƒ± hesaplar mƒ±sƒ±n?">
                <span class="bullet"></span>
                <span><strong>Karƒ±≈üƒ±k</strong> sistem: √ßim + damla</span>
              </button>
            </div>

            <div class="input-row">
              <div class="input-group">
                <div class="input-label-row">
                  <span><strong>Sorunuzu detaylƒ± yazƒ±n</strong></span>
                  <span>Bah√ße alanƒ±, ≈üekli, su kaynaƒüƒ± (≈üebeke/kuyu/depo), otomasyon isteƒüi vb. mutlaka belirtin.</span>
                </div>
                <div class="textarea-wrapper">
                  <textarea id="userInput" name="message" rows="2" placeholder="√ñrn: 300 m¬≤ dikd√∂rtgen bah√ßem var. ≈ûebeke suyu, 4 bar. Tam otomatik √ßim sulama sistemi ve malzeme listesi √ßƒ±karƒ±r mƒ±sƒ±n?"></textarea>
                </div>
                <div class="input-counter" id="charCounter">0 / 1000 karakter</div>
              </div>

              <div>
                <button id="sendBtn" type="submit" class="send-button">
                  <span class="icon">‚û§</span>
                  <span class="text">G√∂nder</span>
                </button>
                <div class="send-key-hint">Enter: G√∂nder ‚Ä¢ Shift+Enter: Satƒ±r atla</div>
              </div>
            </div>
          </form>
        </div>

        <div class="right-panel">
          <div class="right-panel-card">
            <div class="right-panel-card-header">
              <div class="right-panel-title">
                <span class="dot"></span>
                Sulama hesabƒ± i√ßin ipu√ßlarƒ±
              </div>
            </div>
            <div class="right-panel-subtitle">
              A≈üaƒüƒ±daki bilgileri ne kadar net verirsen, hesabƒ±n doƒüruluƒüu o kadar artar:
            </div>

            <div class="example-list">
              <div class="example-item">
                <strong>1. Alan ve ≈üekil</strong>
                <span>Toplam m¬≤, dikd√∂rtgen / L / U ≈üekli, eƒüim durumu, teraslar, √ßim + peyzaj ayrƒ±mƒ±.</span>
              </div>
              <div class="example-item">
                <strong>2. Su kaynaƒüƒ±</strong>
                <span>≈ûebeke / kuyu / depo, varsa hidrofor ve yakla≈üƒ±k √ßalƒ±≈üma basƒ±ncƒ± (bar) + debi (l/dk) bilgisi.</span>
              </div>
              <div class="example-item">
                <strong>3. Otomasyon</strong>
                <span>Manuel musluk mu, yoksa tam otomatik kontrol √ºnitesi + vana kutularƒ± mƒ± istediƒüini mutlaka s√∂yle.</span>
              </div>
            </div>

            <div class="usage-row">
              <span><strong>G√ºnl√ºk limit:</strong> 30 soru</span>
              <div class="usage-bar">
                <div class="usage-bar-fill" id="usageFill"></div>
              </div>
            </div>

            <div class="alert-box">
              <span class="icon">‚ö†Ô∏è</span>
              <div>
                <strong>√ñNEMLƒ∞:</strong> Bu asistan hen√ºz <strong>beta a≈üamasƒ±ndadƒ±r</strong>. Hidrolik hesap ve √ºr√ºn e≈üle≈ütirmelerinde
                hata yapabilir; √ßƒ±kardƒ±ƒüƒ± malzeme listelerini mutlaka profesyonel bir uygulamacƒ± ile kontrol edin.
              </div>
            </div>
          </div>

          <div class="right-panel-card">
            <div class="right-panel-card-header">
              <div class="right-panel-title">
                <span class="dot"></span>
                Sƒ±nƒ±rlamalar ve uyarƒ±lar
              </div>
            </div>
            <div class="right-panel-subtitle">
              ≈ûimdilik a≈üaƒüƒ±daki kapsamda √ßalƒ±≈üƒ±r:
            </div>

            <ul class="example-list">
              <li class="example-item">
                <strong>Vƒ∞LLA / PEYZAJ AƒûIRLIKLI</strong>
                <span>Tarla sulamasƒ±, end√ºstriyel tesisler veya seralar i√ßin hesaplar hen√ºz deneme a≈üamasƒ±ndadƒ±r.</span>
              </li>
              <li class="example-item">
                <strong>KABACA MALƒ∞YET ANALƒ∞Zƒ∞</strong>
                <span>Verdiƒüi fiyatlar yakla≈üƒ±k olup stok, kur ve tedarik ko≈üullarƒ±na g√∂re deƒüi≈üiklik g√∂sterebilir.</span>
              </li>
            </ul>

            <div class="footer-note">
              <strong>Hukuki uyarƒ±:</strong> Sulama Asistanƒ±, bir <strong>yapay zek√¢ destekli danƒ±≈üman</strong>dƒ±r. Nihai proje,
              uygulama ve ke≈üif sorumluluƒüu kullanƒ±cƒ±dadƒ±r.
            </div>

            <div class="disclaimer">
              <strong>Not:</strong> Bu sistem beta s√ºr√ºm√ºndedir. Hesaplama ve tavsiyelerde hata yapabilir, her zaman g√ºncel
              standartlara uygun √ßalƒ±≈ümayabilir. L√ºtfen ger√ßek sahada uygulamadan √∂nce bir uzmana doƒürulatƒ±n.
            </div>

            <div class="tag-row">
              <div class="tag">#villa_sulama</div>
              <div class="tag">#peyzaj_sulama</div>
              <div class="tag">#otomatik_sulama</div>
              <div class="tag">#damla_sulama</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var messagesEl = document.getElementById("messages");
    var chatForm = document.getElementById("chatForm");
    var userInputEl = document.getElementById("userInput");
    var sendBtn = document.getElementById("sendBtn");
    var thinkingIndicator = document.getElementById("thinkingIndicator");
    var charCounter = document.getElementById("charCounter");
    var usageFill = document.getElementById("usageFill");

    var chatLocked = false;
    var dailyLimit = 30;
    var usedToday = 0;

    function formatTime(date) {
      var h = date.getHours();
      var m = date.getMinutes();
      if (m < 10) m = "0" + m;
      return h + ":" + m;
    }

    function addMessage(role, text, opts) {
      opts = opts || {};
      var isSystemWarning = opts.systemWarning || false;

      var wrapper = document.createElement("div");
      wrapper.className =
        "message " + role + (isSystemWarning ? " system-warning" : "");

      var icon = document.createElement("div");
      icon.className = "message-icon " + role;
      icon.textContent = role === "user" ? "üòÄ" : "üíß";

      var bubble = document.createElement("div");
      bubble.className = "message-bubble";

      var header = document.createElement("div");
      header.className = "message-header";

      var meta = document.createElement("div");
      meta.className = "message-meta";

      var roleEl = document.createElement("span");
      roleEl.className = "message-role";
      roleEl.textContent = role === "user" ? "Kullanƒ±cƒ±" : "Sulama Asistanƒ±";

      var timeEl = document.createElement("span");
      timeEl.className = "message-timestamp";
      timeEl.textContent = formatTime(new Date());

      meta.appendChild(roleEl);
      meta.appendChild(timeEl);
      header.appendChild(meta);

      var modelTag = document.createElement("span");
      modelTag.className = "message model-tag";
      modelTag.textContent =
        role === "assistant" ? "Model: SulamaAsistani-GPT" : "";
      header.appendChild(modelTag);

      var content = document.createElement("div");
      content.className = "message-content";

      if (text) {
        // Satƒ±r sonlarƒ±nƒ± koruyarak HTML olarak bas
        var safe = text.replace(/\n/g, "<br>");
        content.innerHTML = safe;
      }

      bubble.appendChild(header);
      bubble.appendChild(content);

      wrapper.appendChild(icon);
      wrapper.appendChild(bubble);

      messagesEl.appendChild(wrapper);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      // STREAM i√ßin content elementini geri d√∂nd√ºr√ºyoruz
      return { wrapper: wrapper, bubble: bubble, content: content };
    }


    function setThinking(isThinking) {
      if (isThinking) {
        thinkingIndicator.style.display = "inline-flex";
      } else {
        thinkingIndicator.style.display = "none";
      }
    }

    function setInputDisabled(disabled) {
      userInputEl.disabled = disabled;
      sendBtn.disabled = disabled;
      chatLocked = disabled;
    }

    function updateCharCounter() {
      var len = userInputEl.value.length;
      charCounter.textContent = len + " / 1000 karakter";
      if (len > 1000) {
        charCounter.style.color = "#f97373";
      } else {
        charCounter.style.color = "var(--text-softer)";
      }
    }

    function updateUsageBar() {
      var ratio = Math.min(usedToday / dailyLimit, 1);
      usageFill.style.width = (ratio * 100).toFixed(0) + "%";
    }

    userInputEl.addEventListener("input", updateCharCounter);

    userInputEl.addEventListener("keydown", function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        chatForm.dispatchEvent(new Event("submit", { cancelable: true }));
      }
    });

    document.querySelectorAll(".helper-chip").forEach(function (btn) {
      btn.addEventListener("click", function () {
        var example = btn.getAttribute("data-example");
        if (!example) return;
        userInputEl.value = example;
        updateCharCounter();
        userInputEl.focus();
      });
    });
    async function sendAssistantMessage(text, storedUser) {
  var projectState = null;

  try {
    var res = await fetch("/api/sulama", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: text,
        designData: projectState,
        user: { email: storedUser.email }
      })
    });

    // Limit / hata kontrolleri
    if (!res.ok || !res.body) {
      var rawErr = "";
      try {
        rawErr = await res.text();
      } catch (e) {
        rawErr = "";
      }

      if (res.status === 403 && rawErr.toLowerCase().indexOf("limit") !== -1) {
        setThinking(false);
        addMessage(
          "assistant",
          rawErr ||
            "G√ºnl√ºk soru limitiniz sunucu tarafƒ±nda dolmu≈ü g√∂r√ºn√ºyor. L√ºtfen daha sonra tekrar deneyin veya y√∂neticinizle ileti≈üime ge√ßin.",
          { systemWarning: true }
        );
        setInputDisabled(true);
        return;
      }

      setThinking(false);
      addMessage(
        "assistant",
        "Sunucudan ge√ßerli bir yanƒ±t alƒ±namadƒ±. (" + rawErr + ")"
      );
      return;
    }

    var reader = res.body.getReader();
    var decoder = new TextDecoder("utf-8");

    // Asistan balonunu olu≈ütur (bo≈ü)
    var msgObj = addMessage("assistant", "", {});
    var contentEl = msgObj && msgObj.content ? msgObj.content : null;

    // T√ºm cevabƒ± burada biriktireceƒüiz
    var fullText = "";

    // Artƒ±k "d√º≈ü√ºn√ºyor" yazƒ±sƒ±nƒ± kapatabiliriz
    setThinking(false);

    while (true) {
      var result = await reader.read();
      if (result.done) break;

      var chunk = decoder.decode(result.value, { stream: true });
      if (!chunk) continue;

      fullText += chunk;

      if (contentEl) {
        // STREAM SIRASINDA: sade text olarak g√∂ster (HTML'e dokunma)
        contentEl.textContent += chunk;
      }

      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // STREAM Bƒ∞TTƒ∞KTEN SONRA: artƒ±k tam metni HTML olarak bas
    if (contentEl) {
      contentEl.innerHTML = fullText.replace(/&lt;/g, "<").replace(/&gt;/g, ">");

    }
  } catch (err) {
    console.error("ƒ∞stek hatasƒ± (stream):", err);
    setThinking(false);
    addMessage(
      "assistant",
      "Sunucuyla baƒülantƒ±da bir sorun olu≈ütu. L√ºtfen biraz sonra tekrar dene."
    );
  } finally {
    setInputDisabled(false);
    userInputEl.focus();
  }
}


    chatForm.addEventListener("submit", function (e) {
  e.preventDefault();
  if (chatLocked) return;

  var text = userInputEl.value.trim();
  if (!text) return;

  if (usedToday >= dailyLimit) {
    addMessage(
      "assistant",
      "G√ºnl√ºk soru limitine ula≈ütƒ±nƒ±z. L√ºtfen yarƒ±n tekrar deneyin.",
      { systemWarning: true }
    );
    return;
  }

  addMessage("user", text);
  userInputEl.value = "";
  updateCharCounter();

  usedToday++;
  updateUsageBar();

  setInputDisabled(true);
  setThinking(true);

  // localStorage‚Äôdan kullanƒ±cƒ± bilgisi √ßek
  var storedUser = null;
  try {
    var rawUser = localStorage.getItem("user");
    if (rawUser) storedUser = JSON.parse(rawUser);
  } catch (e) {
    storedUser = null;
  }

  if (!storedUser || !storedUser.email) {
    setThinking(false);
    setInputDisabled(false);
    addMessage(
      "assistant",
      "Devam edebilmek i√ßin √∂nce giri≈ü yapmanƒ±z gerekiyor.",
      { systemWarning: true }
    );
    return;
  }

  // STREAM √áAƒûRISI
  sendAssistantMessage(text, storedUser);
});



    function logoutUser() {
      try {
        localStorage.removeItem("user");
      } catch (e) {}
      // √áƒ±kƒ±≈ütan sonra login sayfasƒ±na g√∂nder
      window.location.href = "/login";
    }

    window.addEventListener("load", function () {
      // 1) Google'dan geldiysek e-postayƒ± URL'den √ßek
      try {
        var params = new URLSearchParams(window.location.search);
        var googleEmail = params.get("googleEmail");
        if (googleEmail) {
          localStorage.setItem(
            "user",
            JSON.stringify({ email: googleEmail.toLowerCase() })
          );
          // URL'i temizle (parametre kalmasƒ±n)
          params.delete("googleEmail");
          var newUrl =
            window.location.pathname +
            (params.toString() ? "?" + params.toString() : "");
          window.history.replaceState({}, "", newUrl);
        }
      } catch (e) {
        console.warn("googleEmail parse edilemedi:", e);
      }

      // 2) √ústteki Giri≈ü/Kayƒ±t veya Kullanƒ±cƒ±/√áƒ±kƒ±≈ü butonlarƒ±nƒ± ayarla
      var storedUser = null;
      try {
        var rawUser2 = localStorage.getItem("user");
        if (rawUser2) storedUser = JSON.parse(rawUser2);
      } catch (e) {
        storedUser = null;
      }

      var authButtons = document.getElementById("authButtons");
      if (authButtons) {
        if (storedUser && storedUser.email) {
          authButtons.innerHTML =
            '<span style="font-size:11px;color:var(--text-soft);max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">' +
            storedUser.email +
            '</span>' +
            '<button type="button" class="auth-btn" onclick="logoutUser()">√áƒ±kƒ±≈ü Yap</button>';
        } else {
          authButtons.innerHTML =
            '<a href="/login" class="auth-btn primary">Giri≈ü Yap</a>' +
            '<a href="/register" class="auth-btn">Kayƒ±t Ol</a>';
        }
      }

      usedToday = 0;
      updateUsageBar();
      updateCharCounter();

      addMessage(
        "assistant",
        "Merhaba, ben Sulama Asistanƒ±.\n\nVilla ve peyzaj bah√ßeleri i√ßin otomatik sulama sistemi hesabƒ±, zone planlama, boru √ßapƒ± se√ßimi ve kabaca malzeme listesi √ßƒ±karabilirim.\n\nBa≈ülamadan √∂nce l√ºtfen bah√ßenizin yakla≈üƒ±k m¬≤ bilgisini, ≈üekil tarifini (dikd√∂rtgen, L vb.), su kaynaƒüƒ±nƒ±zƒ± (≈üebeke / kuyu / depo) ve otomasyon isteƒüinizi kƒ±saca yazƒ±n."
      );
    });
  </script>
</body>
</html>